// ===================================================================================
// SSD1306 128x64 Pixels OLED Minimal Functions                               * v1.0 *
// ===================================================================================
//
// Collection of the most necessary functions for controlling an SSD1306 128x64 pixels
// I2C OLED.
//
// References:
// -----------
// - TinyOLEDdemo: https://github.com/wagiminator/attiny13-tinyoleddemo
// - Neven Boyanov: https://github.com/tinusaur/ssd1306xled
// - Stephen Denne: https://github.com/datacute/Tiny4kOLED
//
// 2022 by Stefan Wagner: https://github.com/wagiminator

#include "oled_min.h"
#include "i2c.h"

// OLED initialisation sequence
// const uint8_t OLED_INIT_CMD[] = {
//   OLED_MULTIPLEX,   0x3F,                 // set multiplex ratio  
//   OLED_CHARGEPUMP,  0x14,                 // set DC-DC enable  
//   OLED_MEMORYMODE,  0x00,                 // set horizontal addressing mode
//   OLED_COLUMNS,     0x00, 0x7F,           // set start and end column
//   OLED_PAGES,       0x00, 0x3F,           // set start and end page
//   OLED_COMPINS,     0x12,                 // set com pins
//   OLED_XFLIP, OLED_YFLIP,                 // flip screen
//   OLED_DISPLAY_ON                         // display on
// };

// // OLED initialisation sequence
// const uint8_t OLED_INIT_CMD[] = {
//   OLED_MULTIPLEX,   0x3F,                 // set multiplex ratio  
//   OLED_CHARGEPUMP,  0x14,                 // set DC-DC enable  
//   OLED_MEMORYMODE,  0x00,                 // set page addressing mode
//   OLED_COLUMNS,     0x00, 0x7F,           // set start and end column
//   OLED_PAGES,       0x00, 0x3F,           // set start and end page
//   OLED_COMPINS,     0x12,                 // set com pins
//   OLED_XFLIP, OLED_YFLIP,                 // flip screen
//   OLED_DISPLAY_ON                         // display on
// };


// По цьому вдалось адаптувати 128x32
// https://github.com/adafruit/Adafruit_SSD1306/blob/master/Adafruit_SSD1306.cpp

#define SSD1306_EXTERNALVCC 0x01  ///< External display voltage source
#define SSD1306_SWITCHCAPVCC 0x02 ///< Gen. display voltage from 3.3V

#define vccstate SSD1306_SWITCHCAPVCC


#if ((OLED_WIDTH == 128) && (OLED_HEIGHT == 32)) 
  #define comPins 0x02
  #define contrast 0x8F
#elif ((OLED_WIDTH == 128) && (OLED_HEIGHT == 64))
  #define comPins 0x12
  #define contrast  ((vccstate == SSD1306_EXTERNALVCC) ? 0x9F : 0xCF)
#elif ((OLED_WIDTH == 96) && (OLED_HEIGHT == 16)) 
  #define comPins 0x2
  #define contrast  ((vccstate == SSD1306_EXTERNALVCC) ? 0x10 : 0xAF)
#endif


// OLED initialisation sequence
const uint8_t OLED_INIT_CMD[] = {
  OLED_DISPLAY_OFF,
  OLED_CLOCKDIV,    0x80,           // set clock divide ratio
  OLED_MULTIPLEX,   (OLED_HEIGHT-1),       // set multiplex ratio (HEIGHT-1)
  OLED_OFFSET, 0x00,                // set display offset
  OLED_STARTLINE | 0x00,            // set display start line
  OLED_CHARGEPUMP, 0x14,            // set DC-DC enable (0x10-external VCC, 0x14 - internal DC-DC)
  OLED_MEMORYMODE, 0x00,            // set horizontal addressing mode
  OLED_XFLIP, OLED_YFLIP,           // flip screen

  OLED_COMPINS, comPins,
  OLED_CONTRAST, contrast,
  OLED_SETPRECHARGE, ((vccstate == SSD1306_EXTERNALVCC) ? 0x22 : 0xF1),
  OLED_SETVCOMDETECT, 0x40,
  OLED_DISPLAYALLON_RESUME,
  OLED_INVERT_OFF,
  OLED_SCROLL_OFF,
  OLED_DISPLAY_ON,                 // display on
};

// OLED init function
void OLED_init(void) {
  I2C_init();                             // initialize I2C first

  // goto end;
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_CMD_MODE);               // set command mode
  for(unsigned i = 0; i < sizeof(OLED_INIT_CMD); i++)
    I2C_write(OLED_INIT_CMD[i]);          // send the command bytes

  I2C_stop();                             // stop transmission
}

// Start sending data
void OLED_data_start(void) {
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_DAT_MODE);               // set data mode
}

// Start sending command
void OLED_command_start(void) {
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_CMD_MODE);               // set command mode
}

// OLED send command
void OLED_send_command(uint8_t cmd) {
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_CMD_MODE);               // set command mode
  I2C_write(cmd);                         // send command
  I2C_stop();                             // stop transmission
}

// OLED set cursor position
void OLED_setpos(uint8_t x, uint8_t y) {
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_CMD_MODE);               // set command mode
  I2C_write(OLED_PAGE | y);	              // set page start address
  I2C_write(x & 0x0F);			              // set lower nibble of start column
  I2C_write(OLED_COLUMN_HIGH | (x >> 4)); // set higher nibble of start column
  I2C_stop();                             // stop transmission
}

// OLED fill screen
void OLED_fill(uint8_t p) {
  OLED_setpos(0, 0);                      // set cursor to display start
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_DAT_MODE);               // set data mode
  // for(uint16_t i=128*8; i; i--) I2C_write(p); // send pattern
  for(uint16_t i=OLED_WIDTH*OLED_HEIGHT/8; i; i--) I2C_write(p); // send pattern
  I2C_stop();                             // stop transmission
}

// OLED draw bitmap
void OLED_draw_bmp(uint8_t x0, uint8_t y0, uint8_t x1, uint8_t y1, const uint8_t* bmp) {
  for(uint8_t y = y0; y < y1; y++) {
    OLED_setpos(x0, y);
    I2C_start(OLED_ADDR);
    I2C_write(OLED_DAT_MODE);
    for(uint8_t x = x0; x < x1; x++)
      I2C_write(*bmp++);
    I2C_stop();
  }
}

// Standard ASCII 5x8 font (adapted from Neven Boyanov and Stephen Denne)
const uint8_t OLED_FONT[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2F, 0x00, 0x00, 0x00, 0x07, 0x00, 0x07, 0x00,
  0x14, 0x7F, 0x14, 0x7F, 0x14, 0x24, 0x2A, 0x7F, 0x2A, 0x12, 0x23, 0x13, 0x08, 0x64, 0x62,
  0x36, 0x49, 0x55, 0x22, 0x50, 0x00, 0x05, 0x03, 0x00, 0x00, 0x00, 0x1C, 0x22, 0x41, 0x00,
  0x00, 0x41, 0x22, 0x1C, 0x00, 0x14, 0x08, 0x3E, 0x08, 0x14, 0x08, 0x08, 0x3E, 0x08, 0x08,
  0x00, 0x00, 0xA0, 0x60, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x60, 0x60, 0x00, 0x00,
  0x20, 0x10, 0x08, 0x04, 0x02, 0x3E, 0x51, 0x49, 0x45, 0x3E, 0x00, 0x42, 0x7F, 0x40, 0x00,
  0x42, 0x61, 0x51, 0x49, 0x46, 0x21, 0x41, 0x45, 0x4B, 0x31, 0x18, 0x14, 0x12, 0x7F, 0x10,
  0x27, 0x45, 0x45, 0x45, 0x39, 0x3C, 0x4A, 0x49, 0x49, 0x30, 0x01, 0x71, 0x09, 0x05, 0x03,
  0x36, 0x49, 0x49, 0x49, 0x36, 0x06, 0x49, 0x49, 0x29, 0x1E, 0x00, 0x36, 0x36, 0x00, 0x00,
  0x00, 0x56, 0x36, 0x00, 0x00, 0x08, 0x14, 0x22, 0x41, 0x00, 0x14, 0x14, 0x14, 0x14, 0x14,
  0x00, 0x41, 0x22, 0x14, 0x08, 0x02, 0x01, 0x51, 0x09, 0x06, 0x32, 0x49, 0x59, 0x51, 0x3E,
  0x7C, 0x12, 0x11, 0x12, 0x7C, 0x7F, 0x49, 0x49, 0x49, 0x36, 0x3E, 0x41, 0x41, 0x41, 0x22,
  0x7F, 0x41, 0x41, 0x22, 0x1C, 0x7F, 0x49, 0x49, 0x49, 0x41, 0x7F, 0x09, 0x09, 0x09, 0x01,
  0x3E, 0x41, 0x49, 0x49, 0x7A, 0x7F, 0x08, 0x08, 0x08, 0x7F, 0x00, 0x41, 0x7F, 0x41, 0x00,
  0x20, 0x40, 0x41, 0x3F, 0x01, 0x7F, 0x08, 0x14, 0x22, 0x41, 0x7F, 0x40, 0x40, 0x40, 0x40,
  0x7F, 0x02, 0x0C, 0x02, 0x7F, 0x7F, 0x04, 0x08, 0x10, 0x7F, 0x3E, 0x41, 0x41, 0x41, 0x3E,
  0x7F, 0x09, 0x09, 0x09, 0x06, 0x3E, 0x41, 0x51, 0x21, 0x5E, 0x7F, 0x09, 0x19, 0x29, 0x46,
  0x46, 0x49, 0x49, 0x49, 0x31, 0x01, 0x01, 0x7F, 0x01, 0x01, 0x3F, 0x40, 0x40, 0x40, 0x3F,
  0x1F, 0x20, 0x40, 0x20, 0x1F, 0x3F, 0x40, 0x38, 0x40, 0x3F, 0x63, 0x14, 0x08, 0x14, 0x63,
  0x07, 0x08, 0x70, 0x08, 0x07, 0x61, 0x51, 0x49, 0x45, 0x43, 0x00, 0x7F, 0x41, 0x41, 0x00,
  0x02, 0x04, 0x08, 0x10, 0x20, 0x00, 0x41, 0x41, 0x7F, 0x00, 0x04, 0x02, 0x01, 0x02, 0x04,
  0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x01, 0x02, 0x04, 0x00, 0x20, 0x54, 0x54, 0x54, 0x78,
  0x7F, 0x48, 0x44, 0x44, 0x38, 0x38, 0x44, 0x44, 0x44, 0x20, 0x38, 0x44, 0x44, 0x48, 0x7F,
  0x38, 0x54, 0x54, 0x54, 0x18, 0x08, 0x7E, 0x09, 0x01, 0x02, 0x18, 0xA4, 0xA4, 0xA4, 0x7C,
  0x7F, 0x08, 0x04, 0x04, 0x78, 0x00, 0x44, 0x7D, 0x40, 0x00, 0x40, 0x80, 0x84, 0x7D, 0x00,
  0x7F, 0x10, 0x28, 0x44, 0x00, 0x00, 0x41, 0x7F, 0x40, 0x00, 0x7C, 0x04, 0x18, 0x04, 0x78,
  0x7C, 0x08, 0x04, 0x04, 0x78, 0x38, 0x44, 0x44, 0x44, 0x38, 0xFC, 0x24, 0x24, 0x24, 0x18,
  0x18, 0x24, 0x24, 0x18, 0xFC, 0x7C, 0x08, 0x04, 0x04, 0x08, 0x48, 0x54, 0x54, 0x54, 0x20,
  0x04, 0x3F, 0x44, 0x40, 0x20, 0x3C, 0x40, 0x40, 0x20, 0x7C, 0x1C, 0x20, 0x40, 0x20, 0x1C,
  0x3C, 0x40, 0x30, 0x40, 0x3C, 0x44, 0x28, 0x10, 0x28, 0x44, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C,
  0x44, 0x64, 0x54, 0x4C, 0x44, 0x08, 0x36, 0x41, 0x41, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00,
  0x00, 0x41, 0x41, 0x36, 0x08, 0x08, 0x04, 0x08, 0x10, 0x08, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
};

// Steeled from here: https://github.com/lynniemagoo/oled-font-pack/blob/master/fonts/16x16/arial-bold-font-16x16.js
#define FONT_W 16
const uint16_t font[] = {
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // <space>
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x37fc,0x37fc,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // !
    0x0000,0x0000,0x0000,0x0000,0x0000,0x003c,0x003c,0x0000,0x0000,0x003c,0x003c,0x0000,0x0000,0x0000,0x0000,0x0000,  // "
    0x0000,0x0000,0x0660,0x3660,0x3f60,0x0ff0,0x36fc,0x3f6c,0x0ff0,0x06fc,0x066c,0x0660,0x0000,0x0000,0x0000,0x0000,  // #
    0x0000,0x0000,0x0000,0x0000,0x0c70,0x1cf8,0x31cc,0x7ffe,0x338c,0x1f18,0x0e10,0x0000,0x0000,0x0000,0x0000,0x0000,  // $
    0x0000,0x0078,0x00fc,0x0084,0x2084,0x30fc,0x1c78,0x0f00,0x03c0,0x00e0,0x1e38,0x3f1c,0x2104,0x2100,0x3f00,0x1e00,  // %
    0x0000,0x0000,0x0000,0x0e00,0x1f38,0x31fc,0x30cc,0x33cc,0x37cc,0x1e7c,0x1c38,0x1f00,0x3a00,0x1000,0x0000,0x0000,  // &
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x003c,0x003c,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // '
    0x0000,0x0000,0x0000,0x0000,0x0000,0x07f0,0x1ffc,0x380e,0x2002,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // (
    0x0000,0x0000,0x0000,0x0000,0x0000,0x2002,0x380e,0x1ffc,0x07f0,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // )
    0x0000,0x0000,0x00c0,0x08c0,0x0c80,0x1f80,0x07f0,0x03f0,0x07f0,0x1f80,0x0c80,0x08c0,0x00c0,0x0000,0x0000,0x0000,  // *
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0300,0x0300,0x0300,0x1fe0,0x1fe0,0x0300,0x0300,0x0300,0x0000,0x0000,0x0000,  // +
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x4c00,0x3c00,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // ,
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0300,0x0300,0x0300,0x0300,0x0300,0x0000,0x0000,0x0000,0x0000,0x0000,  // -
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x1800,0x1800,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // .
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x3000,0x3f00,0x0ff0,0x00fc,0x000c,0x0000,0x0000,0x0000,0x0000,0x0000,  // /

    0x0000,0x0000,0x0000,0x0000,0x0ff0,0x1ff8,0x381c,0x300c,0x300c,0x381c,0x1ff8,0x0ff0,0x0000,0x0000,0x0000,0x0000,  // 0
    0x0000,0x0000,0x0000,0x0000,0x0060,0x0030,0x0018,0x3ffc,0x3ffc,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // 1
    0x0000,0x0000,0x0000,0x0000,0x3030,0x3838,0x3c1c,0x360c,0x370c,0x338c,0x31f8,0x3070,0x0000,0x0000,0x0000,0x0000,  // 2
    0x0000,0x0000,0x0000,0x0000,0x0c10,0x1c18,0x381c,0x30cc,0x30cc,0x39cc,0x1ffc,0x0f38,0x0000,0x0000,0x0000,0x0000,  // 3
    0x0000,0x0000,0x0000,0x0000,0x0e00,0x0f00,0x0dc0,0x0ce0,0x0c38,0x3ffc,0x3ffc,0x0c00,0x0000,0x0000,0x0000,0x0000,  // 4
    0x0000,0x0000,0x0000,0x0000,0x0de0,0x1dfc,0x38dc,0x30cc,0x30cc,0x39cc,0x1f8c,0x0f00,0x0000,0x0000,0x0000,0x0000,  // 5
    0x0000,0x0000,0x0000,0x0000,0x07e0,0x1ff8,0x399c,0x30cc,0x30cc,0x31cc,0x1f9c,0x0f18,0x0000,0x0000,0x0000,0x0000,  // 6
    0x0000,0x0000,0x0000,0x0000,0x000c,0x000c,0x3c0c,0x3f8c,0x07ec,0x007c,0x001c,0x000c,0x0000,0x0000,0x0000,0x0000,  // 7
    0x0000,0x0000,0x0000,0x0000,0x0e70,0x1ff8,0x318c,0x318c,0x318c,0x318c,0x1ff8,0x0e70,0x0000,0x0000,0x0000,0x0000,  // 8
    0x0000,0x0000,0x0000,0x0000,0x18f0,0x39f8,0x338c,0x330c,0x330c,0x399c,0x1ff8,0x07e0,0x0000,0x0000,0x0000,0x0000,  // 9
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0c18,0x0c18,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // :
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x4c18,0x3c18,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // ;
    0x0000,0x0000,0x0000,0x0100,0x0380,0x0380,0x06c0,0x06c0,0x0c60,0x0c60,0x1830,0x0000,0x0000,0x0000,0x0000,0x0000,  // <
    0x0000,0x0000,0x0000,0x0330,0x0330,0x0330,0x0330,0x0330,0x0330,0x0330,0x0330,0x0330,0x0000,0x0000,0x0000,0x0000,  // =
    0x0000,0x0000,0x0000,0x0000,0x1830,0x0c60,0x0c60,0x06c0,0x06c0,0x0380,0x0380,0x0100,0x0000,0x0000,0x0000,0x0000,  // >
    0x0000,0x0000,0x0000,0x0000,0x0030,0x0038,0x001c,0x370c,0x378c,0x01cc,0x00f8,0x0070,0x0000,0x0000,0x0000,0x0000,  // ?

    0x0000,0x0000,0x03e0,0x0418,0x09e4,0x13f6,0x131a,0x111a,0x13f2,0x13fa,0x121c,0x090c,0x04f8,0x0000,0x0000,0x0000,  // @
    0x0000,0x0000,0x2000,0x3c00,0x1f80,0x07f0,0x067c,0x060c,0x067c,0x07f0,0x1f80,0x3c00,0x2000,0x0000,0x0000,0x0000,  // A
    0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x318c,0x318c,0x318c,0x318c,0x318c,0x31fc,0x1f78,0x0e00,0x0000,0x0000,0x0000,  // B
    0x0000,0x0000,0x0000,0x07e0,0x1ff8,0x1c38,0x300c,0x300c,0x300c,0x300c,0x381c,0x1c38,0x0810,0x0000,0x0000,0x0000,  // C
    0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x300c,0x300c,0x300c,0x300c,0x300c,0x1818,0x1ff8,0x07e0,0x0000,0x0000,0x0000,  // D
    0x0000,0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x318c,0x318c,0x318c,0x318c,0x318c,0x318c,0x318c,0x0000,0x0000,0x0000,  // E
    0x0000,0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x018c,0x018c,0x018c,0x018c,0x018c,0x000c,0x0000,0x0000,0x0000,0x0000,  // F
    0x0000,0x0000,0x07e0,0x1ff8,0x1c38,0x300c,0x300c,0x300c,0x330c,0x330c,0x3b1c,0x1f38,0x1f10,0x0000,0x0000,0x0000,  // G
    0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x0180,0x0180,0x0180,0x0180,0x0180,0x0180,0x3ffc,0x3ffc,0x0000,0x0000,0x0000,  // H
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // I
    0x0000,0x0000,0x0000,0x0000,0x0c00,0x1c00,0x3800,0x3000,0x3000,0x3800,0x1ffc,0x0ffc,0x0000,0x0000,0x0000,0x0000,  // J
    0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x0300,0x0180,0x00c0,0x01e0,0x07b0,0x0e18,0x3c0c,0x3004,0x0000,0x0000,0x0000,  // K
    0x0000,0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x3000,0x3000,0x3000,0x3000,0x3000,0x3000,0x0000,0x0000,0x0000,0x0000,  // L
    0x0000,0x0000,0x3ffc,0x3ffc,0x003c,0x03f0,0x1f80,0x3c00,0x1f80,0x03f0,0x003c,0x3ffc,0x3ffc,0x0000,0x0000,0x0000,  // M
    0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x0038,0x0070,0x01c0,0x0380,0x0e00,0x1c00,0x3ffc,0x3ffc,0x0000,0x0000,0x0000,  // N
    0x0000,0x0000,0x07e0,0x1ff8,0x1818,0x300c,0x300c,0x300c,0x300c,0x300c,0x1818,0x1ff8,0x07e0,0x0000,0x0000,0x0000,  // O

    0x0000,0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x018c,0x018c,0x018c,0x018c,0x01dc,0x00f8,0x0070,0x0000,0x0000,0x0000,  // P
    0x0000,0x0000,0x07e0,0x1ff8,0x1818,0x300c,0x300c,0x340c,0x3c0c,0x180c,0x3c18,0x7ff8,0x47e0,0x0000,0x0000,0x0000,  // Q
    0x0000,0x0000,0x0000,0x3ffc,0x3ffc,0x018c,0x018c,0x018c,0x038c,0x078c,0x1edc,0x3cf8,0x3070,0x2000,0x0000,0x0000,  // R
    0x0000,0x0000,0x0000,0x0000,0x0c70,0x1cf8,0x38dc,0x31cc,0x318c,0x318c,0x3b9c,0x1f38,0x0e30,0x0000,0x0000,0x0000,  // S
    0x0000,0x0000,0x0000,0x000c,0x000c,0x000c,0x000c,0x3ffc,0x3ffc,0x000c,0x000c,0x000c,0x000c,0x0000,0x0000,0x0000,  // T
    0x0000,0x0000,0x0000,0x0ffc,0x1ffc,0x3800,0x3000,0x3000,0x3000,0x3000,0x3800,0x1ffc,0x0ffc,0x0000,0x0000,0x0000,  // U
    0x0000,0x0000,0x0004,0x003c,0x01f8,0x07c0,0x3f00,0x3800,0x3f00,0x07c0,0x01f8,0x003c,0x0004,0x0000,0x0000,0x0000,  // V
    0x0000,0x0000,0x001c,0x03fc,0x3fe0,0x3c00,0x3fe0,0x03fc,0x001c,0x03fc,0x3fe0,0x3c00,0x3fe0,0x03fc,0x001c,0x0000,  // W
    0x0000,0x0000,0x0000,0x300c,0x381c,0x1e78,0x07e0,0x03c0,0x07e0,0x1e78,0x381c,0x300c,0x0000,0x0000,0x0000,0x0000,  // X
    0x0000,0x0000,0x0000,0x000c,0x001c,0x0078,0x00e0,0x3f80,0x3f80,0x00e0,0x0078,0x001c,0x000c,0x0000,0x0000,0x0000,  // Y
    0x0000,0x0000,0x0000,0x0000,0x3000,0x380c,0x3e0c,0x370c,0x33cc,0x30ec,0x307c,0x301c,0x300c,0x0000,0x0000,0x0000,  // Z
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x7ffe,0x7ffe,0x6006,0x6006,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // [
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x000c,0x00fc,0x0ff0,0x3f00,0x3000,0x0000,0x0000,0x0000,0x0000,0x0000,  // <backslash>
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x6006,0x6006,0x7ffe,0x7ffe,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // ]
    0x0000,0x0000,0x0000,0x0000,0x0080,0x00f0,0x007c,0x000e,0x000e,0x007c,0x00f0,0x0080,0x0000,0x0000,0x0000,0x0000,  // ^
    0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,0x6000,  // _

    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0004,0x000c,0x0008,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // `
    0x0000,0x0000,0x0000,0x0000,0x0e60,0x1f70,0x1b30,0x19b0,0x19b0,0x0ff0,0x1fe0,0x1000,0x0000,0x0000,0x0000,0x0000,  // a
    0x0000,0x0000,0x0000,0x0000,0x1ffe,0x1ffe,0x0c60,0x1830,0x1830,0x1c70,0x0fe0,0x07c0,0x0000,0x0000,0x0000,0x0000,  // b
    0x0000,0x0000,0x0000,0x0000,0x07c0,0x0fe0,0x1c70,0x1830,0x1830,0x1c70,0x0c60,0x0000,0x0000,0x0000,0x0000,0x0000,  // c
    0x0000,0x0000,0x0000,0x0000,0x07c0,0x0fe0,0x1c70,0x1830,0x1830,0x0c60,0x1ffe,0x1ffe,0x0000,0x0000,0x0000,0x0000,  // d
    0x0000,0x0000,0x0000,0x0000,0x07c0,0x0fe0,0x1db0,0x19b0,0x19b0,0x0de0,0x05c0,0x0000,0x0000,0x0000,0x0000,0x0000,  // e
    0x0000,0x0000,0x0000,0x0000,0x0030,0x1ffc,0x1ffe,0x0036,0x0036,0x0006,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // f
    0x0000,0x0000,0x0000,0x33e0,0x77f0,0x6e38,0x6c18,0x6c18,0x6630,0x7ff8,0x3ff8,0x0000,0x0000,0x0000,0x0000,0x0000,  // g
    0x0000,0x0000,0x0000,0x0000,0x1ffe,0x1ffe,0x0060,0x0030,0x0030,0x0030,0x1ff0,0x1fe0,0x0000,0x0000,0x0000,0x0000,  // h
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x1fec,0x1fec,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // i
    0x0000,0x0000,0x0000,0x0000,0x0000,0xc000,0xc000,0xffec,0x7fec,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // j
    0x0000,0x0000,0x0000,0x0000,0x1ffe,0x1ffe,0x0380,0x01c0,0x07e0,0x1f30,0x1810,0x0000,0x0000,0x0000,0x0000,0x0000,  // k
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x1ffe,0x1ffe,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // l
    0x0000,0x0000,0x1ff0,0x1ff0,0x0060,0x0030,0x0030,0x1ff0,0x1fe0,0x0060,0x0030,0x0030,0x1ff0,0x1fe0,0x0000,0x0000,  // m
    0x0000,0x0000,0x0000,0x0000,0x1ff0,0x1ff0,0x0060,0x0030,0x0030,0x0030,0x1ff0,0x1fe0,0x0000,0x0000,0x0000,0x0000,  // n
    0x0000,0x0000,0x0000,0x0000,0x07c0,0x0fe0,0x1c70,0x1830,0x1830,0x1c70,0x0fe0,0x07c0,0x0000,0x0000,0x0000,0x0000,  // o

    0x0000,0x0000,0x0000,0x0000,0xfff0,0xfff0,0x0c60,0x1830,0x1830,0x1c70,0x0fe0,0x07c0,0x0000,0x0000,0x0000,0x0000,  // p
    0x0000,0x0000,0x0000,0x0000,0x07c0,0x0fe0,0x1c70,0x1830,0x1830,0x0c60,0xfff0,0xfff0,0x0000,0x0000,0x0000,0x0000,  // q
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x1ff0,0x1ff0,0x0060,0x0030,0x0030,0x0030,0x0000,0x0000,0x0000,0x0000,  // r
    0x0000,0x0000,0x0000,0x0000,0x0ce0,0x1df0,0x19b0,0x19b0,0x1b30,0x1f70,0x0e60,0x0000,0x0000,0x0000,0x0000,0x0000,  // s
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0030,0x0ffc,0x1ffe,0x1830,0x1830,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // t
    0x0000,0x0000,0x0000,0x0000,0x0ff0,0x1ff0,0x1800,0x1800,0x1800,0x0c00,0x1ff0,0x1ff0,0x0000,0x0000,0x0000,0x0000,  // u
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0070,0x03f0,0x1f80,0x1c00,0x1f80,0x03f0,0x0070,0x0000,0x0000,0x0000,0x0000,  // v
    0x0000,0x0000,0x0030,0x03f0,0x1fc0,0x1c00,0x1f80,0x03f0,0x0070,0x03f0,0x1f80,0x1c00,0x1fc0,0x03f0,0x0030,0x0000,  // w
    0x0000,0x0000,0x0000,0x0000,0x0000,0x1830,0x1c70,0x0fe0,0x0380,0x0fe0,0x1c70,0x1830,0x0000,0x0000,0x0000,0x0000,  // x
    0x0000,0x0000,0x0000,0x0000,0x0030,0xc0f0,0xc7c0,0xff00,0x7c00,0x1f00,0x07c0,0x00f0,0x0030,0x0000,0x0000,0x0000,  // y
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x1830,0x1e30,0x1f30,0x1bb0,0x19f0,0x18f0,0x1830,0x0000,0x0000,0x0000,  // z
    0x0000,0x0000,0x0000,0x0000,0x00c0,0x00c0,0x3ffe,0x7f3f,0x6003,0x6003,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // {
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0xffff,0xffff,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,  // |
    0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x6003,0x6003,0x7f3f,0x3ffe,0x00c0,0x00c0,0x0000,0x0000,0x0000,0x0000,  // }
    0x0000,0x0000,0x0000,0x0000,0x0018,0x000c,0x000c,0x000c,0x001c,0x0018,0x0018,0x0018,0x000c,0x0000,0x0000,0x0000   // ~
};


// OLED plot a single character
void OLED_plotChar(char c) {
  uint8_t i;
  uint16_t ptr = c - 32;                  // character pointer
  ptr += ptr << 2;                        // -> ptr = (ch - 32) * 5;
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_DAT_MODE);               // set data mode
  for(i=5 ; i; i--) I2C_write(OLED_FONT[ptr++]);
  I2C_write(0x00);                        // write space between characters
  I2C_stop();                             // stop transmission
}

// OLED print string
void OLED_print(char* str) {
  while(*str) OLED_plotChar(*str++);
}

void OLED_prints(uint8_t x, uint8_t y, char* str) {
  OLED_setpos(0, 0);
  I2C_start(OLED_ADDR);                   // start transmission to OLED
  I2C_write(OLED_DAT_MODE);               // set data mode
  while(*str) {
    uint8_t c = *str++;
    uint16_t ptr = c - 32;                  // character pointer

    ptr += ptr << 2;                        // -> ptr = (ch - 32) * 5;
    for(unsigned i = 5; i; i--) I2C_write(OLED_FONT[ptr++]);
    I2C_write(0x00);                        // write space between characters

  }
  I2C_stop();                             // stop transmission

}

// void OLED_draw_buffer(uint8_t* buffer, size_t buffer_size)
// {
//   // I2C_start(OLED_ADDR);                           // start transmission to OLED
//   // I2C_write(OLED_DAT_MODE);                       // set command mode
//   I2C_writeBuffer(buffer, buffer_size); // send screen buffer using DMA
// }
